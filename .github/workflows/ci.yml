name: CI

on:
  pull_request:
    types: [opened, synchronize, reopened]

jobs:
  check-pr-title:
    runs-on: ubuntu-latest
    steps:
      - name: Check PR title
        shell: bash
        run: |
          echo "ğŸ” PR ì œëª© ê²€ì‚¬ì¤‘..."

          # PR ì œëª© ê°€ì ¸ì˜¤ê¸°
          PR_TITLE=$(jq -r .pull_request.title "$GITHUB_EVENT_PATH")
          echo "PR title: $PR_TITLE"

          REGEX='^(feat|fix|docs|chore|refactor|test|style|perf|ci)<([A-Z][a-zA-Z0-9]*)(,[A-Z][a-zA-Z0-9]*)*>[[:space:]]*: .+$'

          if [[ ! "$PR_TITLE" =~ $REGEX ]]; then
            echo "âŒ PR ì œëª© ê·œì¹™ ìœ„ë°˜!"
            echo "í˜•ì‹: ì‘ì—…ì¢…ë¥˜<ë„ë©”ì¸1,ë„ë©”ì¸2,...> : ì‘ì—…ë‚´ì—­"
            echo "ì˜ˆì‹œ:"
            echo "  feat<Auth,Profile> : ë¡œê·¸ì¸ ë° í”„ë¡œí•„ ê¸°ëŠ¥ êµ¬í˜„"
            echo "  fix<Payment> : ê²°ì œ ì˜¤ë¥˜ ìˆ˜ì •"
            exit 1
          else
            echo "âœ… PR ì œëª© ê·œì¹™ í†µê³¼!"
          fi

  build:
    name: ë¹Œë“œ í…ŒìŠ¤íŠ¸
    runs-on: ubuntu-latest
    needs: check-pr-title
    steps:
      - uses: actions/checkout@v3
      - name: Setup Node.js
        uses: actions/setup-node@v3
        with:
          node-version: 20
      - name: Install dependencies
        run: npm ci
      - name: Run ESLint
        run: npx eslint . --max-warnings=0
      - name: Run TypeScript Build
        run: npm run build
